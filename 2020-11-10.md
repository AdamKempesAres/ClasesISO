# Repaso de examen
* https://github.com/jesusninoc/ClasesISO/blob/master/2020-11-05.md#examen-de-noviembre
## Solución complicada
* https://github.com/jesusninoc/ClasesSAD/blob/master/2020-11-06.md#caso-me-est%C3%A1n-espiando

-----------
-----------

#  IF en PowerShell
* https://www.jesusninoc.com/07/02/2-programacion-en-powershell/#Sentencias_condicionales

# Ejemplos con IF

## Pedir al usuario un nombre de usuario y un password
```PowerShell
$usuario=Read-Host "Introduzca nombre de usuario"
$pass=Read-Host "Introduzca nombre de usuario"
$usuario
$pass
```

## Pedir al usuario un nombre de usuario y un password y comprobar si es "juan"

```PowerShell
$usuario=Read-Host "Introduzca nombre de usuario"
$pass=Read-Host "Introduzca nombre de usuario"
$usuario
$pass
if($usuario -eq "juan")
{

}
else
{

}
```

## Introducir un nombre y pass y ver si es correcto

```PowerShell
$usuario=Read-Host "Introduzca nombre de usuario"
$pass=Read-Host "Introduzca nombre de usuario"
$usuario
$pass
if($usuario -eq "hola")
{
"el uusario es hola"
}
else
{
"el usuario no es hola"
}
```

## Introducir pass y ver si es correcto
```PowerShell
$user=Read-Host
$pass=Read-Host
if($user -eq "pepito" -and $pass -eq "secreto")
{
Write-Host $user
}
```

---------------

# Switch en PowerShell
* https://www.jesusninoc.com/2016/08/09/sentencia-condicional-switch/

# Ejemplos
## Ejemplos sobre operaciones con switch
```PowerShell
$a=Read-Host "Introduzca operación"
switch($a){
'+'{
echo Suma
break
}
}
```
## Pedir una operación y si es "suma" realizar una suma
```PowerShell
$a=Read-Host "Introduzca operación"
switch($a){
'+'{
suma
break
}
}

function suma()
{
2+3
}
```

-----------
-----------

# Ejercicios

## Crear dos ficheros TXT, convertirlos a PDF y juntarlos con Poppler
```PowerShell
# Instalar en Ubuntu Poppler 
# $ sudo apt-get install poppler-utils

"pagina 1" | Out-File 01-22-10-2019.txt
"pagina 2" | Out-File 02-22-10-2019.txt

gc .\01-22-10-2019.txt | Out-Printer "Microsoft Print to PDF"
gc .\02-22-10-2019.txt | Out-Printer "Microsoft Print to PDF"

ls *.pdf

wsl ls
wsl pdfunite 01-22-10-2019-P.pdf 02-22-10-2019-P.pdf out.pdf
.\out.pdf

```

## Crear cinco directorios y dentro de cada directorio crear 10 ficheros
```PowerShell
foreach($directorio in 1..5)
{
    New-Item -Name $directorio -WhatIf -ItemType Directory
    foreach($fichero in 1..10)
    {
        New-Item -Path $directorio -Name $fichero -WhatIf -ItemType File 
    }
}
```

## Crear una estructura de directorios
```PowerShell
notepad amigos.txt

mkdir (gc .\amigos.txt)

foreach($elementitos in gc .\amigos.txt)
{
    Set-Location $elementitos
    mkdir "iso","fol","redes"
    cd ..
}
```

## Crear una estructura de directorios
```PowerShell
## 1 -> ISO   -> 1EVA
## 1 -> ISO   -> 2EVA
## 1 -> ISO   -> 3EVA
## 1 -> REDES -> 1EVA
## 1 -> REDES -> 2EVA
## 2 -> ISO   -> 1EVA
## 2 -> ISO   -> 2EVA
## 5

foreach($alumnos in 1..5)
{
    New-Item -Name $alumnos -ItemType Directory -Force
    foreach($materias in "iso","redes","fol")
    {
        New-Item -Name $materias -ItemType Directory -Path $alumnos -Force
        foreach($evaluacion in "1eva","2eva","3eva")
        {
            $ruta = [String]$alumnos + "\" + $materias 
            $ruta 
            New-Item -Name $evaluacion -ItemType Directory -Path $ruta -Force
            Write-Host $alumnos $materias $evaluacion
        }   
    }
}
```

## Crear una estructura de directorios (pero solo los números pares)
```PowerShell
## 2 -> ISO   -> 1EVA
## 2 -> ISO   -> 2EVA

foreach($alumnos in 1..5)
{
    New-Item -Name ($alumnos*2) -ItemType Directory -Force
    foreach($materias in "iso","redes","fol")
    {
        New-Item -Name $materias -ItemType Directory -Path ($alumnos*2) -Force
        foreach($evaluacion in "1eva","2eva","3eva")
        {
            $ruta = [String]($alumnos*2) + "\" + $materias 
            $ruta 
            New-Item -Name $evaluacion -ItemType Directory -Path $ruta -Force
            Write-Host ($alumnos*2) $materias $evaluacion
        }   
    }
}
```

## Crear una estructura de directorios (pero solo los números impares)
```PowerShell
## 1 -> ISO   -> 1EVA
## 3 -> ISO   -> 2EVA

for($alumnos=1;$alumnos -lt 5;$alumnos=$alumnos+2)
{
    New-Item -Name $alumnos -ItemType Directory -Force
    foreach($materias in "iso","redes","fol")
    {
        New-Item -Name $materias -ItemType Directory -Path $alumnos -Force
        foreach($evaluacion in "1eva","2eva","3eva")
        {
            $ruta = [String]$alumnos + "\" + $materias 
            $ruta 
            New-Item -Name $evaluacion -ItemType Directory -Path $ruta -Force
            Write-Host $alumnos $materias $evaluacion
        }   
    }
}
```

## Leer operaciones de un fichero y realizarlas

### Estructura del fichero asignaturas.txt (0 crear fichero, 1 crear directorio)
```
iso,0
aso,1
```

### Leer del fichero que tiene las asignaturas
```PowerShell
$fichero=get-content asignaturas.txt
$fichero | % {
$_
}
```

### Leer del fichero que tiene las asignaturas y obtener solo la operación que hay que realizar
```PowerShell
$fichero=get-content asignaturas.txt
$fichero | % {
$_.split(',')[1]
}
```

### Leer el fichero y detectar la operación a realizar utilizando el switch
```PowerShell
$fichero = Get-Content asignaturas.txt
$fichero | % {
    $operacion = $_.split(",")
    switch($operacion[1]){
        '0'{
            echo "crear fichero"
            New-Item -Name $operacion[0] -ItemType File -Force
            break
        }
        '1'{
            echo "crear directorio"
            mkdir $operacion[0] -Force
            break
        }
    }
}
```

---------------
---------------

# Administración y aseguramiento de la información:
- Sistemas de archivos:
  - Propietarios y libres.
  - Rutas y nombres de archivos. Estructura jerárquica.
- Gestión de sistemas de archivos mediante comandos y entornos gráficos.
- Gestión de enlaces.
- Estructura de directorios de sistemas operativos libres y propietarios.
- Búsqueda de información del sistema mediante comandos y herramientas gráficas.


---------------

# Ejemplos

## Crear dos ficheros y mostrar el nombre sin la extensión
```PowerShell
"fichero" > 123-10.txt
"fichero" > 123-11.txt
 
Get-ChildItem 123*.txt
foreach($elementos in (Get-ChildItem 123-??.txt).name)
{
    $elementos.Split("-")[1].replace(".txt","")
}
```

## Crear una carpeta por cada servicio
```PowerShell
mkdir (Get-Service).Name -WhatIf
```

## Trabajar con fechas
```PowerShell
$mes = (get-date).Month
$ano = (get-date).year
$dia = (get-date).Day
mkdir $ano$mes$dia -WhatIf
```

## Trabajar con fechas (día anterior)
```PowerShell
$mes = (get-date).AddDays(-1).Month
$ano = (get-date).AddDays(-1).Year
$dia = (get-date).AddDays(-1).Day
mkdir $ano$mes$dia -WhatIf
```

## Trabajar con fechas (listar varios días)
```PowerShell
-1..-7
 
foreach($dias in (-1..-7))
{
    $dias
}
 
foreach($dias in (-1..-7))
{
    (Get-Date).AddDays($dias)
}
 
foreach($dias in (-1..-7))
{
    $mes = (get-date).AddDays($dias).Month
    $ano = (get-date).AddDays($dias).Year
    $dia = (get-date).AddDays($dias).Day
    mkdir $ano$mes$dia -WhatIf
}
```

# Ejercicio
## Hay un proceso que falla, revisad la información sobre servicios, procesos e hilos durante una semana (creando ficheros de registro varias veces al día)
 
## Parte 1
## -Crear la carpeta para cada día y para varios momentos del día

### Solución rara (o no), calculando el número de horas
```PowerShell
foreach($dias in (1..168))
{
    $mes = (get-date).AddHours($dias).Month
    $ano = (get-date).AddHours($dias).Year
    $dia = (get-date).AddHours($dias).Day
    $horas = (get-date).AddHours($dias).Hour
    mkdir $ano$mes$dia$horas -WhatIf
}
```
### Solución medio buena
```PowerShell
foreach($dias in (-1..7))
{
    $mes = (get-date).AddDays($dias).Month
    $ano = (get-date).AddDays($dias).Year
    $dia = (get-date).AddDays($dias).Day
    foreach($horas in 0..23)
    {
        mkdir $ano$mes$dia$horas -WhatIf
    }
}
```
### Solución bastante buena
```PowerShell
foreach($dias in (-1..7))
{
    $mes = (get-date).AddDays($dias).Month
    $ano = (get-date).AddDays($dias).Year
    $dia = (get-date).AddDays($dias).Day
    mkdir $ano$mes$dia -WhatIf
   
    foreach($horas in 0..23)
    {
        $ruta = [String]$ano+[String]$mes+[String]$dia
        $ruta
        New-Item -Name $horas -Path $ruta -ItemType Directory -WhatIf
    }
}
```
### Solución mucha locura
```PowerShell
foreach($dias in (-1..7))
{
    [String]$mes = (get-date).AddDays($dias).Month
    [String]$ano = (get-date).AddDays($dias).Year
    [String]$dia = (get-date).AddDays($dias).Day
    [String]$ruta0 = $ano+"\"+$mes+"\"+$dia
    mkdir $ruta0 -WhatIf
   
    foreach($horas in 0..23)
    {
        New-Item -Name $horas -Path $ruta0 -ItemType Directory -WhatIf
    }
}
```

## Parte 2
## -Listar procesos
## -Listar hilos
## -Listar servicios

### Solución que se ejecuta durante una semana (168 horas)
```PowerShell
foreach($veces in 168)
{
    $fecha = (Get-Date).ToString("yyyy\\MM\\dd")
    mkdir $fecha -Force
 
    $hora = (Get-Date).Hour
    New-Item -Name $hora -Path $fecha -ItemType Directory -Force
 
    (Get-Process).Name > ([String]($fecha+"\"+$hora+"\procesos.txt"))
    (Get-Service).Name > ([String]($fecha+"\"+$hora+"\servicios.txt"))
    (Get-Process).Threads > ([String]($fecha+"\"+$hora+"\hilos.txt"))
 
    Start-Sleep -Seconds 3600
}
```

### Solución de Daniel Cebrián
```PowerShell
foreach($dias in (-1..7))
{
    [String]$mes = (get-date).AddDays($dias).Month
    [String]$ano = (get-date).AddDays($dias).Year
    [String]$dia = (get-date).AddDays($dias).Day
    [String]$ruta = $ano+"\"+$mes+"\"+$dia

    mkdir $ruta -Force

    foreach($horas in 0..23)
    {   
        New-Item -Name $horas -Path $ruta -ItemType Directory -Force
        [String]$procesos = (gps).name
        [String]$ruta1= ($ruta+"\"+$horas)
        New-Item -Name procesos.txt -Path $ruta1 -ItemType File -value $procesos -Force
    }
}
```
